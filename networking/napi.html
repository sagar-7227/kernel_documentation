
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>NAPI &#8212; The Linux Kernel 5.4.10-custom documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Netconsole" href="netconsole.html" />
    <link rel="prev" title="HOWTO for multiqueue network device support" href="multiqueue.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">5.4.10-custom-5.4.10-custom</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><!-- SPDX-License-Identifier: GPL-2.0 -->

<p>
<h3 class="kernel-toc-contents">Contents</h3>
<input type="checkbox" class="kernel-toc-toggle" id = "kernel-toc-toggle" checked>
<label class="kernel-toc-title" for="kernel-toc-toggle"></label>

<div class="kerneltoc" id="kerneltoc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/development-process.html">A guide to the Kernel Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/submitting-patches.html">Submitting patches: the essential guide to getting your code into the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/code-of-conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">All development-process docs</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">Driver implementer's API guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../subsystem-apis.html">Kernel subsystem documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../driver-api/index.html">Driver implementer's API guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../locking/index.html">Locking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cdrom/index.html">CD-ROM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpu-freq/index.html">CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fpga/index.html">FPGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l2"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Networking</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="af_xdp.html">AF_XDP</a></li>
<li class="toctree-l3"><a class="reference internal" href="bareudp.html">Bare UDP Tunnelling Module Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="batman-adv.html">batman-adv</a></li>
<li class="toctree-l3"><a class="reference internal" href="can.html">SocketCAN - Controller Area Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="can_ucan_protocol.html">The UCAN Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="device_drivers/index.html">Hardware Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="dsa/index.html">Distributed Switch Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="devlink/index.html">Linux Devlink Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="caif/index.html">CAIF</a></li>
<li class="toctree-l3"><a class="reference internal" href="ethtool-netlink.html">Netlink interface for ethtool</a></li>
<li class="toctree-l3"><a class="reference internal" href="ieee802154.html">IEEE 802.15.4 Developer's Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="j1939.html">J1939 Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="kapi.html">Linux Networking and Network Devices APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="msg_zerocopy.html">MSG_ZEROCOPY</a></li>
<li class="toctree-l3"><a class="reference internal" href="failover.html">FAILOVER</a></li>
<li class="toctree-l3"><a class="reference internal" href="net_dim.html">Net DIM - Generic Network Dynamic Interrupt Moderation</a></li>
<li class="toctree-l3"><a class="reference internal" href="net_failover.html">NET_FAILOVER</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_pool.html">Page Pool API</a></li>
<li class="toctree-l3"><a class="reference internal" href="phy.html">PHY Abstraction Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="sfp-phylink.html">phylink</a></li>
<li class="toctree-l3"><a class="reference internal" href="alias.html">IP-Aliasing</a></li>
<li class="toctree-l3"><a class="reference internal" href="bridge.html">Ethernet Bridging</a></li>
<li class="toctree-l3"><a class="reference internal" href="snmp_counter.html">SNMP counter</a></li>
<li class="toctree-l3"><a class="reference internal" href="checksum-offloads.html">Checksum Offloads</a></li>
<li class="toctree-l3"><a class="reference internal" href="segmentation-offloads.html">Segmentation Offloads</a></li>
<li class="toctree-l3"><a class="reference internal" href="scaling.html">Scaling in the Linux Networking Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="tls.html">Kernel TLS</a></li>
<li class="toctree-l3"><a class="reference internal" href="tls-offload.html">Kernel TLS offload</a></li>
<li class="toctree-l3"><a class="reference internal" href="tls-handshake.html">In-Kernel TLS Handshake</a></li>
<li class="toctree-l3"><a class="reference internal" href="nfc.html">Linux NFC subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="6lowpan.html">Netdev private dataroom for 6lowpan interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="6pack.html">6pack Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="arcnet-hardware.html">ARCnet Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="arcnet.html">ARCnet</a></li>
<li class="toctree-l3"><a class="reference internal" href="atm.html">ATM</a></li>
<li class="toctree-l3"><a class="reference internal" href="ax25.html">AX.25</a></li>
<li class="toctree-l3"><a class="reference internal" href="bonding.html">Linux Ethernet Bonding Driver HOWTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="cdc_mbim.html">cdc_mbim - Driver for CDC MBIM Mobile Broadband modems</a></li>
<li class="toctree-l3"><a class="reference internal" href="dccp.html">DCCP protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="dctcp.html">DCTCP (DataCenter TCP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="dns_resolver.html">DNS Resolver Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="driver.html">Softnet Driver Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="eql.html">EQL Driver: Serial IP Load Balancing HOWTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="fib_trie.html">LC-trie implementation notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="filter.html">Linux Socket Filtering aka Berkeley Packet Filter (BPF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="generic-hdlc.html">Generic HDLC layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="generic_netlink.html">Generic Netlink</a></li>
<li class="toctree-l3"><a class="reference internal" href="gen_stats.html">Generic networking statistics for netlink users</a></li>
<li class="toctree-l3"><a class="reference internal" href="gtp.html">The Linux kernel GTP tunneling module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ila.html">Identifier Locator Addressing (ILA)</a></li>
<li class="toctree-l3"><a class="reference internal" href="ioam6-sysctl.html">IOAM6 Sysfs variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipddp.html">AppleTalk-IP Decapsulation and AppleTalk-IP Encapsulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="ip_dynaddr.html">IP dynamic address hack-port v0.03</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipsec.html">IPsec</a></li>
<li class="toctree-l3"><a class="reference internal" href="ip-sysctl.html">IP Sysctl</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipv6.html">IPv6</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipvlan.html">IPVLAN Driver HOWTO</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipvs-sysctl.html">IPvs-sysctl</a></li>
<li class="toctree-l3"><a class="reference internal" href="kcm.html">Kernel Connection Multiplexor</a></li>
<li class="toctree-l3"><a class="reference internal" href="l2tp.html">L2TP</a></li>
<li class="toctree-l3"><a class="reference internal" href="lapb-module.html">The Linux LAPB Module Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="mac80211-injection.html">How to use packet injection with mac80211</a></li>
<li class="toctree-l3"><a class="reference internal" href="mctp.html">Management Component Transport Protocol (MCTP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="mpls-sysctl.html">MPLS Sysfs variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="mptcp-sysctl.html">MPTCP Sysfs variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="multiqueue.html">HOWTO for multiqueue network device support</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">NAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="netconsole.html">Netconsole</a></li>
<li class="toctree-l3"><a class="reference internal" href="netdev-features.html">Netdev features mess and how to get out from it alive</a></li>
<li class="toctree-l3"><a class="reference internal" href="netdevices.html">Network Devices, the Kernel, and You!</a></li>
<li class="toctree-l3"><a class="reference internal" href="netfilter-sysctl.html">Netfilter Sysfs variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="netif-msg.html">NETIF Msg Level</a></li>
<li class="toctree-l3"><a class="reference internal" href="nexthop-group-resilient.html">Resilient Next-hop Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="nf_conntrack-sysctl.html">Netfilter Conntrack Sysfs variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="nf_flowtable.html">Netfilter's flowtable infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="openvswitch.html">Open vSwitch datapath developer documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="operstates.html">Operational States</a></li>
<li class="toctree-l3"><a class="reference internal" href="packet_mmap.html">Packet MMAP</a></li>
<li class="toctree-l3"><a class="reference internal" href="phonet.html">Linux Phonet protocol family</a></li>
<li class="toctree-l3"><a class="reference internal" href="pktgen.html">HOWTO for the linux packet generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="plip.html">PLIP: The Parallel Line Internet Protocol Device</a></li>
<li class="toctree-l3"><a class="reference internal" href="ppp_generic.html">PPP Generic Driver and Channel Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="proc_net_tcp.html">The proc/net/tcp and proc/net/tcp6 variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="radiotap-headers.html">How to use radiotap headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="rds.html">RDS</a></li>
<li class="toctree-l3"><a class="reference internal" href="regulatory.html">Linux wireless regulatory documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="representors.html">Network Function Representors</a></li>
<li class="toctree-l3"><a class="reference internal" href="rxrpc.html">RxRPC Network Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="rxrpc.html#socket-options">SOCKET OPTIONS</a></li>
<li class="toctree-l3"><a class="reference internal" href="rxrpc.html#security">SECURITY</a></li>
<li class="toctree-l3"><a class="reference internal" href="rxrpc.html#example-client-usage">EXAMPLE CLIENT USAGE</a></li>
<li class="toctree-l3"><a class="reference internal" href="sctp.html">Linux Kernel SCTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="secid.html">LSM/SeLinux secid</a></li>
<li class="toctree-l3"><a class="reference internal" href="seg6-sysctl.html">Seg6 Sysfs variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="skbuff.html">struct sk_buff</a></li>
<li class="toctree-l3"><a class="reference internal" href="smc-sysctl.html">SMC Sysctl</a></li>
<li class="toctree-l3"><a class="reference internal" href="statistics.html">Interface statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="strparser.html">Stream Parser (strparser)</a></li>
<li class="toctree-l3"><a class="reference internal" href="switchdev.html">Ethernet switch device driver model (switchdev)</a></li>
<li class="toctree-l3"><a class="reference internal" href="sysfs-tagging.html">Sysfs tagging</a></li>
<li class="toctree-l3"><a class="reference internal" href="tc-actions-env-rules.html">TC Actions - Environmental Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="tc-queue-filters.html">TC queue based filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="tcp-thin.html">Thin-streams and TCP</a></li>
<li class="toctree-l3"><a class="reference internal" href="team.html">Team</a></li>
<li class="toctree-l3"><a class="reference internal" href="timestamping.html">Timestamping</a></li>
<li class="toctree-l3"><a class="reference internal" href="tipc.html">Linux Kernel TIPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="tproxy.html">Transparent proxy support</a></li>
<li class="toctree-l3"><a class="reference internal" href="tuntap.html">Universal TUN/TAP device driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="udplite.html">The UDP-Lite protocol (RFC 3828)</a></li>
<li class="toctree-l3"><a class="reference internal" href="vrf.html">Virtual Routing and Forwarding (VRF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="vxlan.html">Virtual eXtensible Local Area Networking documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="x25.html">Linux X.25 Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="x25-iface.html">X.25 Device Driver Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="xfrm_device.html">XFRM device - offloading the IPsec computations</a></li>
<li class="toctree-l3"><a class="reference internal" href="xfrm_proc.html">XFRM proc - /proc/net/xfrm_* files</a></li>
<li class="toctree-l3"><a class="reference internal" href="xfrm_sync.html">XFRM</a></li>
<li class="toctree-l3"><a class="reference internal" href="xfrm_sysctl.html">XFRM Syscall</a></li>
<li class="toctree-l3"><a class="reference internal" href="xdp-rx-metadata.html">XDP RX Metadata</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pcmcia/index.html">PCMCIA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timers/index.html">Timers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../watchdog/index.html">Watchdog Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../virt/index.html">Virtualization Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input/index.html">Input Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hwmon/index.html">Hardware Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpu/index.html">GPU Driver Developer's Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accel/index.html">Compute Accelerators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/index.html">Sound Subsystem Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto/index.html">Crypto API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mm/index.html">Memory Management Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PCI/index.html">PCI Bus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scsi/index.html">SCSI Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduler/index.html">Scheduler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peci/index.html">PECI Subsystem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">Locking in the kernel</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/license-rules.html">Linux kernel licensing rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/testing-overview.html">Kernel Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rust/index.html">Rust</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user's and administrator's guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">The kernel build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/reporting-issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">User-space tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

</div>

<script type="text/javascript"> <!--
  var sbar = document.getElementsByClassName("sphinxsidebar")[0];
  let currents = document.getElementsByClassName("current")
  sbar.scrollTop = currents[currents.length - 1].offsetTop;
  --> </script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/networking/napi.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="napi-1">
<span id="napi"></span><h1>NAPI<a class="headerlink" href="#napi-1" title="Permalink to this headline">¶</a></h1>
<p>NAPI is the event handling mechanism used by the Linux networking stack.
The name NAPI no longer stands for anything in particular <a class="footnote-reference brackets" href="#footnote-1" id="footnote-reference-1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<p>In basic operation the device notifies the host about new events
via an interrupt.
The host then schedules a NAPI instance to process the events.
The device may also be polled for events via NAPI without receiving
interrupts first (<a class="reference internal" href="#poll"><span class="std std-ref">busy polling</span></a>).</p>
<p>NAPI processing usually happens in the software interrupt context,
but there is an option to use <a class="reference internal" href="#threaded"><span class="std std-ref">separate kernel threads</span></a>
for NAPI processing.</p>
<p>All in all NAPI abstracts away from the drivers the context and configuration
of event (packet Rx and Tx) processing.</p>
<section id="driver-api">
<h2>Driver API<a class="headerlink" href="#driver-api" title="Permalink to this headline">¶</a></h2>
<p>The two most important elements of NAPI are the struct napi_struct
and the associated poll method. struct napi_struct holds the state
of the NAPI instance while the method is the driver-specific event
handler. The method will typically free Tx packets that have been
transmitted and process newly received packets.</p>
<section id="control-api">
<span id="drv-ctrl"></span><h3>Control API<a class="headerlink" href="#control-api" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="kapi.html#c.netif_napi_add" title="netif_napi_add"><code class="xref c c-func docutils literal notranslate"><span class="pre">netif_napi_add()</span></code></a> and <a class="reference internal" href="kapi.html#c.netif_napi_del" title="netif_napi_del"><code class="xref c c-func docutils literal notranslate"><span class="pre">netif_napi_del()</span></code></a> add/remove a NAPI instance
from the system. The instances are attached to the netdevice passed
as argument (and will be deleted automatically when netdevice is
unregistered). Instances are added in a disabled state.</p>
<p><a class="reference internal" href="kapi.html#c.napi_enable" title="napi_enable"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_enable()</span></code></a> and <a class="reference internal" href="kapi.html#c.napi_disable" title="napi_disable"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_disable()</span></code></a> manage the disabled state.
A disabled NAPI can't be scheduled and its poll method is guaranteed
to not be invoked. <a class="reference internal" href="kapi.html#c.napi_disable" title="napi_disable"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_disable()</span></code></a> waits for ownership of the NAPI
instance to be released.</p>
<p>The control APIs are not idempotent. Control API calls are safe against
concurrent use of datapath APIs but an incorrect sequence of control API
calls may result in crashes, deadlocks, or race conditions. For example,
calling <a class="reference internal" href="kapi.html#c.napi_disable" title="napi_disable"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_disable()</span></code></a> multiple times in a row will deadlock.</p>
</section>
<section id="datapath-api">
<h3>Datapath API<a class="headerlink" href="#datapath-api" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="kapi.html#c.napi_schedule" title="napi_schedule"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_schedule()</span></code></a> is the basic method of scheduling a NAPI poll.
Drivers should call this function in their interrupt handler
(see <a class="reference internal" href="#drv-sched"><span class="std std-ref">Scheduling and IRQ masking</span></a> for more info). A successful call to <a class="reference internal" href="kapi.html#c.napi_schedule" title="napi_schedule"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_schedule()</span></code></a>
will take ownership of the NAPI instance.</p>
<p>Later, after NAPI is scheduled, the driver's poll method will be
called to process the events/packets. The method takes a <code class="docutils literal notranslate"><span class="pre">budget</span></code>
argument - drivers can process completions for any number of Tx
packets but should only process up to <code class="docutils literal notranslate"><span class="pre">budget</span></code> number of
Rx packets. Rx processing is usually much more expensive.</p>
<p>In other words, it is recommended to ignore the budget argument when
performing TX buffer reclamation to ensure that the reclamation is not
arbitrarily bounded; however, it is required to honor the budget argument
for RX processing.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">budget</span></code> argument may be 0 if core tries to only process Tx completions
and no Rx packets.</p>
</aside>
<p>The poll method returns the amount of work done. If the driver still
has outstanding work to do (e.g. <code class="docutils literal notranslate"><span class="pre">budget</span></code> was exhausted)
the poll method should return exactly <code class="docutils literal notranslate"><span class="pre">budget</span></code>. In that case,
the NAPI instance will be serviced/polled again (without the
need to be scheduled).</p>
<p>If event processing has been completed (all outstanding packets
processed) the poll method should call <a class="reference internal" href="kapi.html#c.napi_complete_done" title="napi_complete_done"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_complete_done()</span></code></a>
before returning. <a class="reference internal" href="kapi.html#c.napi_complete_done" title="napi_complete_done"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_complete_done()</span></code></a> releases the ownership
of the instance.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The case of finishing all events and using exactly <code class="docutils literal notranslate"><span class="pre">budget</span></code>
must be handled carefully. There is no way to report this
(rare) condition to the stack, so the driver must either
not call <a class="reference internal" href="kapi.html#c.napi_complete_done" title="napi_complete_done"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_complete_done()</span></code></a> and wait to be called again,
or return <code class="docutils literal notranslate"><span class="pre">budget</span> <span class="pre">-</span> <span class="pre">1</span></code>.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">budget</span></code> is 0 <a class="reference internal" href="kapi.html#c.napi_complete_done" title="napi_complete_done"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_complete_done()</span></code></a> should never be called.</p>
</aside>
</section>
<section id="call-sequence">
<h3>Call sequence<a class="headerlink" href="#call-sequence" title="Permalink to this headline">¶</a></h3>
<p>Drivers should not make assumptions about the exact sequencing
of calls. The poll method may be called without the driver scheduling
the instance (unless the instance is disabled). Similarly,
it's not guaranteed that the poll method will be called, even
if <a class="reference internal" href="kapi.html#c.napi_schedule" title="napi_schedule"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_schedule()</span></code></a> succeeded (e.g. if the instance gets disabled).</p>
<p>As mentioned in the <a class="reference internal" href="#drv-ctrl"><span class="std std-ref">Control API</span></a> section - <a class="reference internal" href="kapi.html#c.napi_disable" title="napi_disable"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_disable()</span></code></a> and subsequent
calls to the poll method only wait for the ownership of the instance
to be released, not for the poll method to exit. This means that
drivers should avoid accessing any data structures after calling
<a class="reference internal" href="kapi.html#c.napi_complete_done" title="napi_complete_done"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_complete_done()</span></code></a>.</p>
</section>
<section id="scheduling-and-irq-masking">
<span id="drv-sched"></span><h3>Scheduling and IRQ masking<a class="headerlink" href="#scheduling-and-irq-masking" title="Permalink to this headline">¶</a></h3>
<p>Drivers should keep the interrupts masked after scheduling
the NAPI instance - until NAPI polling finishes any further
interrupts are unnecessary.</p>
<p>Drivers which have to mask the interrupts explicitly (as opposed
to IRQ being auto-masked by the device) should use the <a class="reference internal" href="kapi.html#c.napi_schedule_prep" title="napi_schedule_prep"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_schedule_prep()</span></code></a>
and <a class="reference internal" href="kapi.html#c.__napi_schedule" title="__napi_schedule"><code class="xref c c-func docutils literal notranslate"><span class="pre">__napi_schedule()</span></code></a> calls:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">napi_schedule_prep</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">napi</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">mydrv_mask_rxtx_irq</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">idx</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* schedule after masking to avoid races */</span>
<span class="w">    </span><span class="n">__napi_schedule</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">napi</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>IRQ should only be unmasked after a successful call to <a class="reference internal" href="kapi.html#c.napi_complete_done" title="napi_complete_done"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_complete_done()</span></code></a>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">budget</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">napi_complete_done</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">napi</span><span class="p">,</span><span class="w"> </span><span class="n">work_done</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">mydrv_unmask_rxtx_irq</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">idx</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">work_done</span><span class="p">,</span><span class="w"> </span><span class="n">budget</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="kapi.html#c.napi_schedule_irqoff" title="napi_schedule_irqoff"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_schedule_irqoff()</span></code></a> is a variant of <a class="reference internal" href="kapi.html#c.napi_schedule" title="napi_schedule"><code class="xref c c-func docutils literal notranslate"><span class="pre">napi_schedule()</span></code></a> which takes advantage
of guarantees given by being invoked in IRQ context (no need to
mask interrupts). Note that PREEMPT_RT forces all interrupts
to be threaded so the interrupt may need to be marked <code class="docutils literal notranslate"><span class="pre">IRQF_NO_THREAD</span></code>
to avoid issues on real-time kernel configurations.</p>
</section>
<section id="instance-to-queue-mapping">
<h3>Instance to queue mapping<a class="headerlink" href="#instance-to-queue-mapping" title="Permalink to this headline">¶</a></h3>
<p>Modern devices have multiple NAPI instances (struct napi_struct) per
interface. There is no strong requirement on how the instances are
mapped to queues and interrupts. NAPI is primarily a polling/processing
abstraction without specific user-facing semantics. That said, most networking
devices end up using NAPI in fairly similar ways.</p>
<p>NAPI instances most often correspond 1:1:1 to interrupts and queue pairs
(queue pair is a set of a single Rx and single Tx queue).</p>
<p>In less common cases a NAPI instance may be used for multiple queues
or Rx and Tx queues can be serviced by separate NAPI instances on a single
core. Regardless of the queue assignment, however, there is usually still
a 1:1 mapping between NAPI instances and interrupts.</p>
<p>It's worth noting that the ethtool API uses a &quot;channel&quot; terminology where
each channel can be either <code class="docutils literal notranslate"><span class="pre">rx</span></code>, <code class="docutils literal notranslate"><span class="pre">tx</span></code> or <code class="docutils literal notranslate"><span class="pre">combined</span></code>. It's not clear
what constitutes a channel; the recommended interpretation is to understand
a channel as an IRQ/NAPI which services queues of a given type. For example,
a configuration of 1 <code class="docutils literal notranslate"><span class="pre">rx</span></code>, 1 <code class="docutils literal notranslate"><span class="pre">tx</span></code> and 1 <code class="docutils literal notranslate"><span class="pre">combined</span></code> channel is expected
to utilize 3 interrupts, 2 Rx and 2 Tx queues.</p>
</section>
</section>
<section id="user-api">
<h2>User API<a class="headerlink" href="#user-api" title="Permalink to this headline">¶</a></h2>
<p>User interactions with NAPI depend on NAPI instance ID. The instance IDs
are only visible to the user thru the <code class="docutils literal notranslate"><span class="pre">SO_INCOMING_NAPI_ID</span></code> socket option.
It's not currently possible to query IDs used by a given device.</p>
<section id="software-irq-coalescing">
<h3>Software IRQ coalescing<a class="headerlink" href="#software-irq-coalescing" title="Permalink to this headline">¶</a></h3>
<p>NAPI does not perform any explicit event coalescing by default.
In most scenarios batching happens due to IRQ coalescing which is done
by the device. There are cases where software coalescing is helpful.</p>
<p>NAPI can be configured to arm a repoll timer instead of unmasking
the hardware interrupts as soon as all packets are processed.
The <code class="docutils literal notranslate"><span class="pre">gro_flush_timeout</span></code> sysfs configuration of the netdevice
is reused to control the delay of the timer, while
<code class="docutils literal notranslate"><span class="pre">napi_defer_hard_irqs</span></code> controls the number of consecutive empty polls
before NAPI gives up and goes back to using hardware IRQs.</p>
</section>
<section id="busy-polling">
<span id="poll"></span><h3>Busy polling<a class="headerlink" href="#busy-polling" title="Permalink to this headline">¶</a></h3>
<p>Busy polling allows a user process to check for incoming packets before
the device interrupt fires. As is the case with any busy polling it trades
off CPU cycles for lower latency (production uses of NAPI busy polling
are not well known).</p>
<p>Busy polling is enabled by either setting <code class="docutils literal notranslate"><span class="pre">SO_BUSY_POLL</span></code> on
selected sockets or using the global <code class="docutils literal notranslate"><span class="pre">net.core.busy_poll</span></code> and
<code class="docutils literal notranslate"><span class="pre">net.core.busy_read</span></code> sysctls. An io_uring API for NAPI busy polling
also exists.</p>
</section>
<section id="irq-mitigation">
<h3>IRQ mitigation<a class="headerlink" href="#irq-mitigation" title="Permalink to this headline">¶</a></h3>
<p>While busy polling is supposed to be used by low latency applications,
a similar mechanism can be used for IRQ mitigation.</p>
<p>Very high request-per-second applications (especially routing/forwarding
applications and especially applications using AF_XDP sockets) may not
want to be interrupted until they finish processing a request or a batch
of packets.</p>
<p>Such applications can pledge to the kernel that they will perform a busy
polling operation periodically, and the driver should keep the device IRQs
permanently masked. This mode is enabled by using the <code class="docutils literal notranslate"><span class="pre">SO_PREFER_BUSY_POLL</span></code>
socket option. To avoid system misbehavior the pledge is revoked
if <code class="docutils literal notranslate"><span class="pre">gro_flush_timeout</span></code> passes without any busy poll call.</p>
<p>The NAPI budget for busy polling is lower than the default (which makes
sense given the low latency intention of normal busy polling). This is
not the case with IRQ mitigation, however, so the budget can be adjusted
with the <code class="docutils literal notranslate"><span class="pre">SO_BUSY_POLL_BUDGET</span></code> socket option.</p>
</section>
<section id="threaded-napi">
<span id="threaded"></span><h3>Threaded NAPI<a class="headerlink" href="#threaded-napi" title="Permalink to this headline">¶</a></h3>
<p>Threaded NAPI is an operating mode that uses dedicated kernel
threads rather than software IRQ context for NAPI processing.
The configuration is per netdevice and will affect all
NAPI instances of that device. Each NAPI instance will spawn a separate
thread (called <code class="docutils literal notranslate"><span class="pre">napi/${ifc-name}-${napi-id}</span></code>).</p>
<p>It is recommended to pin each kernel thread to a single CPU, the same
CPU as the CPU which services the interrupt. Note that the mapping
between IRQs and NAPI instances may not be trivial (and is driver
dependent). The NAPI instance IDs will be assigned in the opposite
order than the process IDs of the kernel threads.</p>
<p>Threaded NAPI is controlled by writing 0/1 to the <code class="docutils literal notranslate"><span class="pre">threaded</span></code> file in
netdev's sysfs directory.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footnote-1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#footnote-reference-1">1</a><span class="fn-bracket">]</span></span>
<p>NAPI was originally referred to as New API in 2.4 Linux.</p>
</aside>
</aside>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/networking/napi.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>